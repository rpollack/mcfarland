```{r setup, include=FALSE, echo=FALSE}

knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE,
	include = FALSE
)
library(tidyverse)
library(stringr)
library(plotly)
library(RMySQL)
library(broom)
library(lubridate)
library(ggjoy)

fgt = theme(
  panel.background = element_rect(color = "lightgrey", fill = "white"),
  axis.title = element_text(family = "Lato"),
  axis.text = element_text(family = "Lato"),
  legend.title = element_text(family = "Lato"),
  legend.text = element_text(family = "Lato"),
  legend.background = element_rect(fill = "white"),
  legend.key = element_rect(fill = "white"),
  plot.title = element_text(family = "Lato"),
  panel.grid.major = element_line(size = .1, color = "lightgrey"),
  panel.grid.minor = element_line(size = 0),
  #strip.background = element_rect(fill = "#50ae26"),
  strip.text = element_text(family="Lato")
  )

fg_db <- dplyr::src_mysql(dbname = Sys.getenv("FG_DB"), 
                            host = Sys.getenv("FG_HOST"), 
                            user = Sys.getenv("FG_USER"),
                            password = Sys.getenv("FG_PW"))
```

### Get data

```{r include=FALSE}

# gd_info <- fg_db %>%
#   tbl("gd_roster") %>%
#   dplyr::select(mlbamid, playerid)

id_info <- fg_db %>%
  tbl("playerid_lookup") %>%
  dplyr::select(mlbamid, playerid) %>%
  collect(n=Inf)

fg_info <- fg_db %>%
  tbl("player_info") %>%
  filter(!BISPosition %in% c("SP", "RP")) %>%
  dplyr::select(PlayerId, FirstName, LastName) %>%
  collect(n=Inf) %>%
  unite(batter_name, FirstName, LastName, sep = " ")

batting_war <- fg_db %>%
  tbl("stats_batting") %>%
  filter(Type == 0, 
         Season >= 2015) %>%
  dplyr::select(playerid, Season, wrc_plus = `wRC+`) %>%
  collect(n=Inf) %>%
  inner_join(fg_info, by=c("playerid" = "PlayerId")) %>%
  inner_join(id_info, by="playerid")


# for each spot in zone ... ratio of swings to takes? can divide px and pz into deciles to compute zones ... 

#get all pitches, then classify as swing/non-swing, then take ratio, then split by baserunner situation

#get all swings
savant_data <- fg_db %>%
  tbl("gd_savant_new") %>%
  filter(description %in% c("foul", "hit_into_play", "hit_into_play_no_out",
                            "hit_into_play_score", "swinging_pitchout", "swinging_strike",
                            "swinging_strike_blocked")) %>%
  dplyr::select(batter, pitcher = player_name, pitcher_mlbam_id = pitcher, game_date, 
                game_year, description, plate_x, plate_z,
                on_1b, on_2b, on_3b, balls, strikes, outs_when_up) %>%
  collect(n=Inf) %>%
  mutate(plate_x = as.numeric(plate_x),
         plate_z = as.numeric(plate_z)) %>%
  #compute inches instead of feet
  mutate(px_in = plate_x * 12,
         pz_in = plate_z * 12,
         
         #don't care WHO the runners are, just where they are
         on_1b = ifelse(on_1b > 0, "Y", "N"),
         on_2b = ifelse(on_2b > 0, "Y", "N"),
         on_3b = ifelse(on_3b > 0, "Y", "N"),
         runners_on_base = paste0(on_1b, on_2b, on_3b)) %>%
  filter(balls <= 3,            #get rid of some weird data
         strikes <= 2) %>%
  unite(count, balls, strikes, sep = "-")
```

```{r}
plate_discipline_overall <- 
  savant_data %>%
  group_by(batter, game_year) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         
         #calculate size of zone per 100 swings
         aggression_factor = discipline_sq_in / (num_swings / 100)) %>%
  filter(num_swings >= 400) %>%
  
  group_by(game_year) %>%  #normalize to year, 100 = average
  mutate(lg_af = mean(aggression_factor)) %>%
  group_by(batter, game_year) %>%
  mutate(af_plus = round(aggression_factor / lg_af * 100, 0)) %>%
  arrange(af_plus) %>%
  inner_join(batting_war, by=c("batter" = "mlbamid", "game_year" = "Season")) %>%
  ungroup() %>%
  dplyr::select(playerid, batter_name, game_year, everything())

plate_discipline_annual <- savant_data %>%
  group_by(batter) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / (num_swings / 3), #divide by 3 since we're looking at 3 seasons
         lg_af = mean(aggression_factor),
         af_plus = round(aggression_factor / lg_af * 100, 3)) %>%
  arrange(af_plus) %>%
  filter(num_swings >= 1200) %>%
  arrange(aggression_factor)
  
  
```


HEADLINE OPTIONS (What am I promising here?)

- UNDERSTANDING HITTER AGGRESSION
- VISUALIZING HITTER AGGRESSION
- 
- 
- 

INTRO

- Set the tone



"Get a good pitch to hit." That's been the language of post-game interviews since as long as I can remember. 

Earlier this year I introduced a way of analyzing hitters' plate coverage; that is, their ability to put a wide variety of balls in play. I found the distribution of horizontal and vertical coordinates that players connected with pitches on. When multiplied together, these measurements formed a box, the size of which demonstrated hitters' abilities to hit a ball fair. Larger boxes indicated more plate coverage; smaller boxes indicated less plate coverage.

Plate coverage is fine and all, but more often we want to understand a hitter's approach to the plate appearance; their plate discipline, if you will. How likely is a hitter to swing at a given pitch? How likely are they to let a given pitch go by for a ball? Pitchers and catchers ask these questions all the time.

We have metrics like Z-Swing% and O-Swing% to measure a hitter's discipline, and we have heatmaps to visualize a hitter's approach. But I was interested in a more fine-grained approach: what's the size of the box a hitter thinks they can do damage in? And how can I compare this box between players?

Aggressive hitters think they can do damage on pitches inside a larger box; patient hitters focus on a smaller box and attempt to do damage there. Think of the cover of Ted Williams' famous book, _The Science of Hitting_, where he shows his attempt to focus on pitches in a particular area:

<show image>

This approach guides players even today. Kris Bryant studied Williams' book religiously [https://www.nytimes.com/2016/10/31/sports/baseball/cubs-kris-bryant-ted-williams-science-of-hitting.html?mcubz=3&_r=0] growing up.  [********** CAN I FIND ANOTHER PLAYER WHO MENTIONS WILLIAMS' BOOK TO BE SELECTIVE ???? ********]


DEFINING AGGRESSION

So: who is the modern-day Ted Williams? To find out I defined a metric called Aggression Factor in the following manner:

- Using Statcast data for each hitter in each year, I found the median absolute deviation (MAD) along the horizontal (MADx) and vertical (MADy) axes of pitches they'd swung at.
- I multiplied these MADx and MADy together to get a sense of the square inches a hitter's attempted to cover.
- I divided this number by the total number of swings and multiplied by 100, to normalize among hitters with different amounts of playing time. This resulting number is the hitter's Aggression Factor (AF). Lower AF's indicate the hitter swings mostly at pitches in one area; higher AF's indicate a player chases pitches in a variety of locations.
- I filtered out hitters who'd swung fewer than 400 times in a season, to prevent role players from polluting the sample too much.



EXAMPLES

Joey Votto and Justin Bour are both left-handed NL first basemen. Whereas in 2017 Votto has an AF of 4.2, Bour has an AF of 12.5. The plots below show pitches they've swung at:
```{r}
ggplot(savant_data %>% filter(game_year == 2017,
                              batter_name %in% c("Joey Votto", "Justin Bour")),
       aes(px_in, pz_in)) + geom_point(color="#8e001c") + facet_grid(~batter_name) + 
  ggtitle("Swings from Select Hitters, 2017") + xlim(-20, 20) +ylim(0, 60) + fgt +
  labs(x="Horizontal Pitch Location (in.)", y="Vertical Pitch Location (in.)")
```

Bour's clearly the more aggressive hitter, swinging at pitches all over the place, including some close to five feet off the ground. Meanwhile Votto's plot demonstrates the patience for which he's known, refusing to chase at balls off the plate and, in particular, recognizing middle-middle pitches really well.

Here's another pair of hitters: Chris Taylor (AF of 5.7 and Hernan Perez (AF of 11.3):

```{r}
ggplot(savant_data %>% 
         filter(game_year == 2017,
                batter_name %in% c("Hernan Perez", "Chris Taylor")), 
       aes(px_in, pz_in)) + geom_point(color="#8e001c") + facet_grid(~batter_name) + 
  ggtitle("Swings from Select Hitters, 2017") + xlim(-20, 20) +ylim(0, 60) + fgt +
  labs(x="Horizontal Pitch Location (in.)", y="Vertical Pitch Location (in.)")
```

Perez is the more aggressive hitter by far. And for those who are surprised by Chris Taylor's offensive line this year (Houston Mitchell at the Los Angeles Times called [http://www.latimes.com/sports/dodgers/la-sp-dodgers-dugout-first-half-20170714-story.html] Taylor's offense "unexpected"), you can see that he's quite selective at the plate. 

LEADERS AND LAGGARDS

The following plot shows the 25 least aggressive hitter-seasons in this dataset:

```{r}

least_aggressive <- plate_discipline_overall %>%
  mutate(wrc_plus = round(wrc_plus, 0),
         aggression_factor = round(aggression_factor, 1)) %>%
  dplyr::select(Name = batter_name, Season = game_year, `wRC+` = wrc_plus, `Aggression Factor+` = af_plus) %>%
  unite(name_season, Name, Season, sep = ", ") %>%
  head(15)

ggplot(least_aggressive, aes(reorder(name_season, -`Aggression Factor+`), `Aggression Factor+`)) + geom_bar(stat="identity", fill="#8e001c") + 
  coord_flip() + fgt + labs(x="") + ggtitle("Most Selective Hitter-Seasons, 2015 - 2019")

```

Seeing Votto at the top of the list validates that we're on the right track. You'll notice that the other hitter-seasons on this list are quite good: mean wRC+ of this group is a whopping 133.

And now the most aggressive hitters in this dataset:
```{r}
most_aggressive <- plate_discipline_overall %>%
  mutate(wrc_plus = round(wrc_plus, 0),
         aggression_factor = round(aggression_factor, 1)) %>%
  dplyr::select(Name = batter_name, Season = game_year, `wRC+` = wrc_plus, `Aggression Factor+` = af_plus) %>%
  unite(name_season, Name, Season, sep = ", ") %>%
  tail(15)

ggplot(most_aggressive, aes(reorder(name_season, -`Aggression Factor+`), `Aggression Factor+`)) + geom_bar(stat="identity", fill="#8e001c") + 
  coord_flip() + fgt + labs(x="") + ggtitle("Most Aggressive Hitter-Seasons, 2015 - 2019")
```

These hitter-seasons aren't so notable. The mean wRC+ of this group is just 87.2

Looking at these two graphs, you might conclude that Aggression Factor correlates with offense. And you'd be right. The following scatterplot and parabola of best-fit show that the more aggressive a hitter becomes, the more his offense drops:

```{r}
ggplot(plate_discipline_overall, aes(af_plus, wrc_plus)) + geom_point(color="#8e001c") + 
  geom_smooth(method = "lm") +
  labs(x="Aggression Factor+", y="wRC+") + 
  ggtitle("It Pays to be Patient at the Plate") + fgt

aggression_factor_model <- lm(plate_discipline_overall$wrc_plus ~ plate_discipline_overall$aggression_factor)
summary(aggression_factor_model)

```

The equation wRC+ = 126.5 - (2.8 * AF), with p < 2.2e-16, fits this data well. The R^2 of .129 indicates that AF explains 13% of the variation in a hitter's wRC+. That's quite a large effect for just one metric to have on a hitter's offense. Also note that the sample size thins out drastically as the AF increases. Players with an AF above 15 tend to not get much playing time. The big exception -- the player whose season is at the upper-right of the graph? That's Gary Sanchez in 2016. He swung at everything (AF of 19.7) yet crushed the ball (wRC+ of 170).

I also broke this dataset into deciles, where Decile 1 contains the least aggressive hitters (AF's from 4.2 to 5.9) and Decile 10 contains the most aggressive hitters (AF's from 22.6 to 41.5), and computed the mean wRC+ in each decile. The results align with common sense: as hitters get more aggressive, their offensive output declines. 
```{r}

plate_discipline_deciles <- plate_discipline_overall %>%
  ungroup() %>%
  mutate(decile = ntile(aggression_factor, 10)) %>%
  group_by(decile) %>%
  summarize(from_disc = min(aggression_factor),
            to_disc = max(aggression_factor),
            mean_wrc_plus = mean(wrc_plus))

ggplot(plate_discipline_deciles, aes(reorder(as.character(decile), decile), mean_wrc_plus)) +
  geom_bar(stat="identity", fill="#8e001c") + labs(x="Decile (1 = Low Aggression, 10 = High Aggression)", y="Mean wRC+") + fgt +
  ggtitle("wRC+ by Aggression Factor Decile")
```

The trend holds up. An increase in aggression is associated with decreased offensive performance.

OVER TIME

Given the upward trend in strikeouts, news outlets today focus on players' lack of plate discipline. "Hitters are swinging for the fences" trumpets a headline in the Portland Press Herald [http://www.pressherald.com/2017/09/17/on-baseball-with-strikeout-stigma-gone-hitters-are-swinging-for-the-fences/]. In December, Rian Watt at FiveThirtyEight wrote [https://fivethirtyeight.com/features/pitchers-wont-throw-strikes-so-batters-are-getting-better-at-hitting-bad-pitches/] that today's hitters are "channeling their inner Vladimir Guerrero". And former pitcher Al Leiter noted that "you don't see a two-strike approach anymore." []      

These statements are correct. At least since 2015 hitters have expanded the strike zone more and more. The following ridgeline plot shows how hitters' AF's have changed over time:
```{r}
ggplot(plate_discipline_overall, aes(as.character(game_year),
                                     aggression_factor)) + geom_boxplot() + coord_flip() + 
  labs(x="", y="Aggression Factor") + 
  ggtitle("Hitters Are Becoming Not Only More Similar, But Also More Aggressive") + fgt

ggplot(plate_discipline_overall, aes(y=as.character(game_year), x=aggression_factor)) +
  geom_joy(scale=1, fill="#8e001c") + fgt +labs(x="Aggression Factor", y="") + ggtitle("Distributions of Aggression Factors over Time")

```

Aggressive hitters are taking over baseball:
- Since 2017, the peak of the AF curve has moved to the right, in the direction of increased aggression. This means the typical player in 2017 is more aggressive than the typical player in 2015.
- After the peak, the shallower downward slope in 2017 indicates players with an AF in the 8 - 12 range are getting more playing time than they used to. 
- Hitters are becoming more similar to each other. After noticing the 2017 graph seemed more bunched together than the one in 2016, I computed the interquartile range for each year. 2017's IQR or 4.09 is less than 2015's IQR of 4.34, indicating less variety among hitters' tendencies. 

### BASE-OUT STATES

Statcast also gives us the base-out state when a hitter's batting. I used this information to see which base-out states induce the most aggression in hitters. The results should not surprise you:

```{r}

#by baserunner state, count, and outs generally.
plate_discipline_by_base_out_states <- savant_data %>%
  group_by(runners_on_base, outs_when_up) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3),
            discipline_sq_in = horiz_disc * vertical_disc,
            aggression_factor = discipline_sq_in / num_swings * 100) %>%
  filter(num_swings >= 10) %>%    
  arrange(aggression_factor)

ggplot(plate_discipline_by_base_out_states, aes(x=runners_on_base, y=as.character(outs_when_up))) +
         geom_point(aes(color=aggression_factor, size=aggression_factor)) +
  ggtitle("Hitter Aggression by Base-Out State, 2015 - 2019") +
  labs(x="Runners On Base (Y = Runner, N = No Runner)", y="Outs") +
  guides(color=guide_legend(), size = guide_legend()) +
  scale_color_gradient(low="green", high = "red") + fgt

```

Hitters become more aggressive as their teammates reach base. In particular, hitters expand the zone wildly when there's only a runner on third and no outs. In a first-and-third situation though, hitters are less aggressive, perhaps because they want to avoid a double play.  


```{r}

aggression_change_by_outs <- plate_discipline_by_base_out_states %>%
  group_by(runners_on_base) %>%
  arrange(outs_when_up) %>%
  mutate(change_in_aggression_from_prev_out = aggression_factor - lag(aggression_factor))


```

Scan the chart from the bottom up. Hitters become less aggressive as the outs pile up. Aggression drops rapidly when there's only a runner on third and no outs becomes one out. Conversely, aggression drops slowly if there are runners on second and third.

WHO'S CALMEST UNDER PRESSURE?

Some hitters control their aggression better than others. By taking the ratio of hitters' AFs in the four most aggressive base states (NYY, YYY, NNY, and YNY) to their AF in the four least aggressive base states (YYN, NYN, YNN, NNN), regardless of the number of outs, we can understand who remains calm under pressure and who gets jumpy when there are RBIs to be had.

```{r}

player_aggression_relative <- savant_data %>%
  mutate(is_high_aggression = ifelse(runners_on_base %in% c("NYY", "YYY", "NNY", "YNY"), "Y", "N")) %>%
  group_by(playerid, batter_name, lastYear, is_high_aggression) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3),
            discipline_sq_in = horiz_disc * vertical_disc,
            aggression_factor = discipline_sq_in / num_swings * 100) %>%
  filter(num_swings >= 50) %>%   #want players who've swung at least 50 times in a season in both situations
  group_by(playerid, batter_name, lastYear) %>%
  arrange(is_high_aggression) %>%   #sorts from N to Y
  mutate(aggression_multiplier = aggression_factor / lag(aggression_factor)) %>%
  filter(lastYear == 2017,
         !is.na(aggression_multiplier)) %>%
  arrange(desc(aggression_multiplier)) %>%
  ungroup()
```


The average player gets nearly 10x as aggressive in this situation, in terms of the horizontal and vertical location of a pitch they'll swing at. 

Who's the calmest when given a chance to knock a runner in?

```{r}
# which players change their approach the most from runner-not-on-third to runner-on-third (when there are 0 outs)

#the least
player_aggression_relative %>%
  dplyr::select(batter_name, aggression_multiplier) %>%
  tail(15) %>%
  ggplot(aes(reorder(batter_name, -aggression_multiplier),
             aggression_multiplier)) +
  geom_bar(stat="identity", fill="#8e001c") + coord_flip() + labs(x="", y="AF Multiplier") + 
  fgt + ggtitle("Hitters Who Change their Approach the Least\n in a Typical High-Aggression Spot")

mean(player_aggression_relative$aggression_multiplier)

```

Raul Mondesi, Curt Casali, and Tony Wolters are as cool as cucumbers when there's a man on third. They become more aggressive than usual, but only by a factor of about 5. That's about half the average increase of 10. 

We can't say that about the following list of hitters:

```{r}
player_aggression_relative %>%
  dplyr::select(batter_name, aggression_multiplier) %>%
  head(15) %>%
  ggplot(aes(reorder(batter_name, aggression_multiplier),
             aggression_multiplier)) +
  geom_bar(stat="identity", fill="#8e001c") + coord_flip() + labs(x="", y="AF Multiplier") +
  fgt + ggtitle("Hitters Who Change their Approach the Most\n in a Typical High-Aggression Spot")
```

Manuel Margot, Tyler Collins, and Travis Jankowski get jumpier than a long-tailed cat in a room full of rocking chairs when they see a runner on third. Know who else does? The best player in baseball. Mike Trout always looks so calm and collected, doesn't he? He never seems to get rattled. Well now we can see what's going through his head when he has a chance to knock a man in from third. He'll expand the strike zone considerably.


```{r}
margot+
```

CONCLUSION

*** What's my callback ??? ***

Who is our modern-day Ted Williams?

When it comes to analyzing plate discipline, we can do more than just look at Z-Swing% and O-Swing% ... 






* * *







I interpret this graph as showing that over time, hitters are becoming not only _more_ aggressive, but also _similarly_ aggressive. Either that, or front offices and managers are selecting for these kinds of players. (It's probably both.)

Between 2015 and 2017 the following changes occurred:
- The median aggression factor increased
- The interquartile range of agggression factors decreased

These changes aren't large by themselves but become noticeable when expressed by the hundreds of major-leaguers each year. We've said for years that hitters are less afraid than ever of striking out [https://calltothepen.com/2017/01/11/mlb-curious-ks-modern-day-hitters/]; the graph above appears to show that not only is this true, but also that managers and GM's are okay with the trend.



```{r}

plate_discipline_overall <- savant_data %>%
  group_by(playerid, batter_name, game_year, lastYear, wrc_plus) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / num_swings * 100) %>%
  filter(num_swings >= 400) %>%    #avg. hitter has 700 swings this is about 1/6 of a full season, to reduce survivor bias
  arrange(aggression_factor) %>%
  ungroup()

least_aggressive_batters <- savant_data %>%
  group_by(batter_name) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / (num_swings / 100)) %>%
  filter(num_swings >= 1200) %>%
  arrange(aggression_factor) %>%
  head(15)

ggplot(least_aggressive_batters, aes(reorder(batter_name, -aggression_factor), aggression_factor)) + 
  geom_bar(stat="identity",  fill="#8e001c") + fgt + coord_flip() + labs(x="", y="Aggression Factor") + 
  ggtitle("Least Aggressive Hitters, 2015 - 2019")



```




```{r}
savant_data %>%
  group_by(batter_name) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / num_swings * 100) %>%
  filter(num_swings >= 1200) %>%
  arrange(aggression_factor) %>%
  tail(15) %>%
  ggplot(aes(reorder(batter_name, -aggression_factor), aggression_factor)) + geom_bar(stat="identity",  fill="#8e001c") +
  fgt + coord_flip() + labs(x="", y="Aggression Factor") + ggtitle("Most Aggressive Hitters, 2015 - 2017")

```







I defined aggression as the median absolute deviation (MAD) along the horizontal and vertical axes of pitches that hitters swung at

### Compute batter aggeression

```{r}







#by batter by baserunner state. who is more aggressive when there are runners on base?
plate_discipline_by_base_state <- savant_data %>%
  group_by(playerid, batter_name, game_year, lastYear, runners_on_base) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / num_swings * 100) %>%
 # filter(num_swings >= 200) %>%    #this is about 1/6 of a full season, to reduce survivor bias
  arrange(aggression_factor)


```




### plots

```{r}

#per_pitch makes no mathematical sense but it equalizes folks and the top of the list 'looks' right in that
#it has really good hitters in it.




```

### compute & plot deciles



### Models for Graphs Above

```{r}


#r^2 = .21!!!

discipline_augmented <- augment(aggression_factor_model)


```

### show votto & bour's aggression to demonstrate the methodology

```{r}

#votto & bour are two great examples; they're both lefties and their plots contrast well.


```


### compute pitcher aggression (that they induce in batters)

```{r}
pitcher_plate_discipline_overall <- savant_data %>%
  group_by(pitcher, game_year) %>%
  summarize(num_swings = n(),
            horiz_disc = round(mad(px_in), 3),
            vertical_disc = round(mad(pz_in), 3)) %>%
  
  #compute af on a per-100-swings basis
  mutate(discipline_sq_in = horiz_disc * vertical_disc,
         aggression_factor = discipline_sq_in / (num_swings / 100)) %>%
  filter(num_swings >= 200) %>%    #this is about 1/6 of a full season, to reduce survivor bias
  arrange(aggression_factor)

ranks_2017 <- plate_discipline_overall %>%
  filter(game_year == 2017) %>%
  mutate(af_rank = percent_rank(aggression_factor) * 100)

# it seems the best pitchers induce lots of swings IN the zone ... but somehow remain untouched.

#correlate discipline_per_100 to xFIP-

ggplot(savant_data %>% filter(game_year == 2017,
                              pitcher %in% c("Justin Verlander", "Brian Johnson")),
       aes(px_in, pz_in)) + geom_point() + facet_wrap(~pitcher) + 
  ggtitle("Swings Induced by Select Pitchers, 2017") + xlim(-20, 20) +ylim(0, 60)
```

### in which base-out states are hitters the most aggressive?





### graph outlier players

```{r}

#pitches from player who gets more aggressive
aggressive_player <- savant_data %>%
  mutate(runner_on_third = ifelse(runners_on_base %in% c("NNY", "NYY", "YNY", "YYY"), "Y", "N")) %>%
  filter(batter_name == "Manuel Margot")

ggplot(aggressive_player, aes(px_in, pz_in)) + geom_point() + facet_wrap(~runner_on_third) +
  ggtitle("Manuel Margot's Aggression w/Runners on Third & Without")

non_aggressive_player <- savant_data %>%
  mutate(runner_on_third = ifelse(runners_on_base %in% c("NNY", "NYY", "YNY", "YYY"), "Y", "N")) %>%
  filter(batter_name == "Raul Mondesi")

ggplot(non_aggressive_player, aes(px_in, pz_in)) + geom_point() + facet_wrap(~runner_on_third) +
  ggtitle("Raul Mondesi's Aggression w/Runners on Third & Without")



```

