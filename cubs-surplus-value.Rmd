---
output:
  pdf_document: default
---

```{r, echo=FALSE}
library(tidyverse)
```

METHODOLOGY 

Surplus value under control has three parts: the number of years a player is under control, their WAR during that time period, and their salary during that time period. Below I describe the process I used to calculate each and any assumptions I made.

To determine the number of years a player is under control, I used team payroll information from Baseball Reference. To simplify my task, I assumed all contract options are exercised and no opt-outs are. I limited the time horizon to five years because I have WAR projections only for the next five years. For example, although Miguel Cabrera is under control for at least seven more years, my analysis only shows him as under control for the next five.

To project WAR I used a method Tom Tango proposed that weights past performance and applies an aging curve. The details are here: http://tangotiger.com/index.php/site/comments/war-marcels-...-warcels; read up if you're interested. The method isn't perfect, particularly when it comes to pitchers, but I trust Tango's methodology enough to go forward. For missing years I gave the player 0 WAR.

Projecting salary was trickier:

- For free-agent contract years, I information when available from Baseball Reference. I noticed they don't defer salary; for example, Chris Davis will make $17M next year, but $23M is listed on the Orioles' payroll page. I used the latter number.
- For 2017 arbitration salaries, I used projections from MLB Trade Rumors.
- For arbitrations years beyond 2017, I applied the 25%/40%/60% research described by Kevin Creagh at The Point of Pittsburgh (http://www.thepointofpittsburgh.com/calculating-mlb-arbitration-percentages/). For example, Jonathan Schoop is projected to earn $3.4M in 2017, his Arb-1 year. To project his Arb-2 salary, I calculated his free-agent AAV as (3.4 / .25), then multiplied by .4 to get a projection of $5.44M. I then used $5.44M to project his Arb-3 salary at $8.16M. 
- For Arb-4 years, I used 70% of free-agent salary. For simplicity's sake, I did not identify Arb-4 players and then apply the 20%/33%/50%/70% progression that Creagh found. The progression in my analysis goes 25%/40%/60%/70%.
- For pre-arb salaries, I used the 2017 league minimum of $535k. I did not step up each year as the CBA dictates.

The toughest part was projecting arbitration salaries for players who will be pre-arb in 2017. No arbitration projection yet exists for these fellas. I used $2.2M, which is the average Arb-1 salary given out in 2016, according to MLBTR's tracker (http://www.mlbtraderumors.com/arbtracker2016). The 25/40/60/70 rubric kicked in for subsequent arbitration projections.

Using averages in situations like these has its perils. For example, we as people know that Kris Bryant will get far more than $2.2M in his first arbitration season. So in the following analysis, his surplus value is drastically overstated. But short of projecting Arb-1 for every player uniquely, this was the best I could do. I'm open to other methods if you'd like to share them in the comments. This area is the biggest shortcoming of this project.

With years of control, WAR under control, and salary under control, I calculated a player's surplus value as (8.5 * _WAR Under Control_) - _Salary_Under_Control_. I inflated the value of WAR by 5% each year of control.

===RESULTS===

OK, now we can get to the results, which are simply this: the Cubs dominate the entire sport of Major League Baseball in terms of talent they control and the surplus value they're getting from that talent. Other teams control their players for longer on average, but no team comes close to the value per dollar Theo Epstein and his crew are getting.

The following table shows the surplus value under control for each team through 2021:

```{r, echo=FALSE}

cubs_tbl <- team_war %>%
  select(-num_players, -war_under_control, -years_of_control, -salary_under_control, - war_under_control_per_year,
         -war_per_player_per_year, -surplus_value_per_year, -mm_per_war_per_year) %>%
  arrange(desc(surplus_value_under_control))

cubs_tbl

```

The Cub's are paying the least for the most talent, even when you factor in that many of their pre-arb players get hurt by the $2.2M Arb-1 projection I mentioned. This projection hurts the Cubs more than any other team because the Cubs have so many pre-arb players to begin with.

Controlled surplus value is nice, but teams have to balance that value with the amount of time they control it. Here again, the Cubs lead the pack. They don't have the longest control over their players, but for the next 3-4 years they have nearly double the surplus value of the next-highest team:

```{r, echo=FALSE}

team_surplus_value <- warcels %>%
  group_by(Team) %>%
  summarize(avg_surplus_value_per_year = sum(surplus_value_under_control) / sum(years_of_control),
            avg_years_of_control = round(mean(years_of_control), 2))

ggplot(team_surplus_value, aes(avg_years_of_control, avg_surplus_value_per_year, Team)) + geom_point() + geom_text(aes(label=Team),hjust=0, vjust=0) + labs(x="Avg. no. of years team controls its current players", y="Avg surplus value each player provides (Millions USD)") + ggtitle("MLB Team Surplue Value Under Control, 2017 - 2021") + xlim(2.5,5) + fgt

```

The Cubs roster averages over $5M in surplus value each year for the next 3-4 years. That's what having a core of pre-arbitration talent does. The next-best team doesn't even average $1M in surplus value per year. The remaining 28 teams, featuring older and/or worse players, don't get any surplus value at all.

```{r, echo=FALSE}
cubs_surplus_value <- warcels %>%
  filter(Team == "CHC") %>%
  mutate(salary_under_control = round(salary_under_control, 1)) %>%
  select(-Position, -Team, -war_per_year_of_control, -dollars_per_win_under_control)

cubs_surplus_value
```

My $2.2M Arb-1 projection makes many of the guys atop this list appear to be better bargains than they are -- Bryant, Russell, and Hendricks especially. These guys will make far more than that in their Arb-1 years. But so will many other players on other teams to whom I applied this projection.

Still, the Cubs are far ahead of everyone else. Seven of their players rank in the top 90% of surplus value and an eighth, Kyle Schwarber, just misses the cut. Two teams have six players at this ranking; seven teams have five players here.

Surplus value isn't everything. Teams need to put talent on the field. Here again, the Cubs shine. The following graph shows simply the average amount of WAR they control each year, across their entire current roster, and the average time they control each player for:

```{r, echo=FALSE}
ggplot(data=team_war, aes(years_of_control, war_under_control_per_year, label=Team)) + geom_point() + geom_text(aes(label=Team),hjust=0, vjust=0) + labs(x="Avg. no. of years team controls its current players", y="Avg. total WAR per year") + ggtitle("MLB Team Control of Talent, 2017-2021") + xlim(2.5,5) + fgt
```





