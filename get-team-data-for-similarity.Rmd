---
title: "Get-team-data"
output: html_document
---

### Get data needed for baseball-teams-similarity.py

```{r}
team_similiarity_data <- fg_db %>% 
  tbl('season_team') %>%
  select(yearID = Season, name = FullName,
         H, D = `2B`, Trip = `3B`, BB, SO, HR,
         BBA, SOA, HRA, HA, CG, SHO,
         SB, R, RA) %>%
  filter(yearId >= 1886) %>%
  arrange(yearId) %>%
  
  #optionally write to CSV here
  collect(n=Inf)
```



### Analyze the 2016 Cubs

```{r}
cubs_similarity <- read_csv("~/baseball-team-similarity/results/2016 Chicago Cubs.csv") %>%
  arrange(desc(simscore))
```

The 2016 Chicago Cubs won 103 games and dominated the major leagues in convincing fashion. Even if they'd flamed out during the playoffs, they would have been an exciting story. Their World Series win was the icing on the cake.

At FiveThirtyEight, ...

I wanted the answer to a different question: throughout history, which teams were the most similar to this year's Cubs? You can define 'similar' in a large number of ways. I chose to adapt Bill James' Player Similarity Scores, featured on Baseball-Reference [http://www.baseball-reference.com/about/similarity.shtml], to teams themselves. In doing so I came up with some interesting results.

METHODOLOGY

I used the same basic concept: start with 1,000 points of similarity between teams, then deduct points for differences in key stats. The higher the score between two teams, the more similar they are.

I compared each team on the following stats:

-- Offense: Runs scored, singles, doubles, triples, home runs, walks, strikeouts, and stolen bases
-- Defense: Runs allowed, hits allowed, home runs allowed, walks allowed, strikeouts achieved, complete games, and shutouts

I diverged from the concept in one important way: instead of comparing teams' raw stats to each other, I compared teams' deviations from league average for that year. This change normalizes the different offensive and defensive eras of the game, allowing true domninance to emerge in the context of each year in history. This change is no different than comparisons to league average baked into stats like WAR.

For example, consider the following scenario (which I made up but which illustrates my point):

- The 2008 Red Sox offense compiled 5% more walks than the average team in 2008
- The 1963 Yankees offense compiled 20% fewer walks than the average team in 1963

The Red Sox's initial score for walks would be 105; the Yankees' score in walks would be 80. My algorithm would compute a difference of 25, which is 105-80, then deduct 25 from the starting score of 1,000. It would then look at how different the teams were in the other stats I mentioned above, while comparing only each team's performance to league average that year. 

THE 2016 CUBS

Based on this algorithm, which team would you guess is most similar to the 2016 Cubs? FiveThirtyEight used Elo rankings throughout history to determine dominance [http://fivethirtyeight.com/features/the-2016-cubs-were-only-the-70th-most-dominant-team-ever/]. This method ranked Cubs in the same neighborhood as the 1949 Red Sox, 1951 Yankees, 1913 Athletics, 1999 Braves, and 1906 Giants.

But I'm looking for similarity, which takes into account _how_ teams succeeded. Did they hit a lot of home runs while striking out a lot? Did they slap a lot of singles while stealing lots of bases? Did they work the count and take lots of walks?

Taking these factors into account, the most similar team to the 2016 Cubs is the 2012 Tampa Bay Rays. Surprised? I certainly was. I don't remember them as a dominant team. I had to look up their record: 90-72, finishing 3rd in the AL East. That doesn't sound dominant. How can they be similar to a 103-win team? 

Here are their raw stat lines:


```{r}
article_data <- team_similiarity_data %>%
  mutate(Team = sprintf("%s %s", yearID, name)) %>%
  filter(Team == "2012 Tampa Bay Rays" | Team == "2016 Chicago Cubs") %>%
  mutate(Singles = H - (D + Trip + HR)) %>%
  select(Team, `Runs Scored` = R, `1B` = Singles, `2B` = D, `3B` = Trip, HR, BB, SO,
         `Runs Allowed` = RA, `Hits Allowed` = HA, `Walks Allowed` = BBA, `Strikeouts by Pitchers` = SOA, `Home Runs Allowed` = HRA,
         CG, SHO)

stats_raw <- read_csv("~/Downloads/cubs and rays comparison - raw (1).csv")

ggplot(data=stats_raw, aes(x=Stat, y=Value, fill=Team)) + geom_bar(stat="identity", position="dodge") + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + scale_fill_manual(values=c("#79BDEE", "#002F6C"))

```


The large scale of the graph makes it difficult to see, but similarities are there. The teams' offenses struck out a similar number of times and hit the same number of triples. Their pitching staffs allowed a similar number of runs.

But differences also exist. The Rays scored 111 fewer runs, hit 43 fewer doubles, hit 24 fewer home runs, and allowed over 100 more hits than the Cubs. To truly see the similarities, you need to compare each team by how they performed relative to that year's competition. The following graph shows this comparison:

```{r}
team_similarity_plus <- read_csv("~/Downloads/cubs and rays comparison - Sheet2.csv")
team_similarity_plus

ggplot(data=team_similarity_plus, aes(x=Stat, y=Value, fill=Team)) + geom_bar(stat="identity", position="dodge") + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + scale_fill_manual(values=c("#79BDEE", "#002F6C"))

```

The smaller scale helps you see that except for complete games relative to average, the teams were very similar.

The similarity score between these teams is 836 (what is the proper word???) Including the 2016 Rays, the ten most similar teams to the 2016 Cubs are:

```{r}
similar_teams <- read_csv("~/Downloads/cubs and rays comparison - other_teams (2).csv")
similar_teams <- similar_teams %>%
  mutate(PCT = round(PCT,3))
similar_teams
```

You'll note some real powerhouses and several World Series champions on this list. Teams that perform like the Cubs do, relative to their competition, typically win their divison (or league, as the case may be). The average winning percentage of this group is .589, or between 95-96 wins in today's game.

CONCLUSION!!


